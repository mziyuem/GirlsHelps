<view class="session-container">
  <!-- çŠ¶æ€æ  -->
  <view class="status-bar">
    <text class="status-text">{{sessionInfo.statusText}}</text>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view class="messages-container" scroll-y="true" scroll-with-animation="true" scroll-top="{{scrollTop}}">
    <view wx:if="{{messages.length === 0}}" class="empty-messages">
      <text class="empty-icon">ğŸ’¬</text>
      <text class="empty-text">æš‚æ— æ¶ˆæ¯ï¼Œå¼€å§‹å¯¹è¯å§</text>
    </view>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <view wx:for="{{messages}}" wx:key="createTime" class="message-item {{item.fromUserId === userInfo.userId ? 'message-own' : 'message-other'}}">
      <!-- å¯¹æ–¹å¤´åƒå’Œæ¶ˆæ¯ (å¤´åƒåœ¨å·¦è¾¹) -->
      <view wx:if="{{item.fromUserId !== userInfo.userId}}" class="message-wrapper other-message">
        <view class="avatar-container">
          <image class="message-avatar" src="{{sessionInfo.otherAvatar || defaultAvatar}}" mode="aspectFill"></image>
        </view>
        <view class="message-bubble-container">
          <view class="message-bubble other-bubble">
            <text class="message-text">{{item.content}}</text>
          </view>
          <text class="message-time">{{formatTime(item.createTime)}}</text>
        </view>
      </view>

      <!-- è‡ªå·±å¤´åƒå’Œæ¶ˆæ¯ (å¤´åƒåœ¨å³è¾¹) -->
      <view wx:if="{{item.fromUserId === userInfo.userId}}" class="message-wrapper own-message">
        <view class="message-bubble-container">
          <view class="message-bubble own-bubble">
            <text class="message-text">{{item.content}}</text>
          </view>
          <text class="message-time">{{formatTime(item.createTime)}}</text>
        </view>
        <view class="avatar-container">
          <image class="message-avatar" src="{{defaultAvatar}}" mode="aspectFill"></image>
        </view>
      </view>
    </view>

    <!-- è§é¢ä¿¡æ¯ -->
    <view wx:if="{{sessionInfo.meetingPoint}}" class="meeting-info">
      <text class="meeting-title">ğŸ“ çº¦å®šè§é¢ä¿¡æ¯</text>
      <text class="meeting-detail">åœ°ç‚¹ï¼š{{sessionInfo.meetingPoint}}</text>
      <text wx:if="{{sessionInfo.meetingTime}}" class="meeting-detail">æ—¶é—´ï¼š{{formatTime(sessionInfo.meetingTime)}}</text>

      <view class="meeting-actions">
        <button class="action-btn primary" bindtap="navigateToMeeting">å¯¼èˆªå‰å¾€</button>
        <button class="action-btn secondary" bindtap="completeSession">å®Œæˆäº’åŠ©</button>
      </view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥æ¡† -->
  <view wx:if="{{sessionInfo.status === 'active'}}" class="input-container">
    <textarea
      class="input-box"
      placeholder="è¾“å…¥æ¶ˆæ¯..."
      value="{{inputMessage}}"
      bindinput="onInputMessage"
      bindconfirm="sendMessage"
      auto-focus="true"
      adjust-position="true"
      maxlength="500"
      show-count="false"
    ></textarea>

    <button
      class="send-btn {{inputMessage.trim() ? '' : 'disabled'}}"
      bindtap="sendMessage"
      disabled="{{!inputMessage.trim()}}"
    >
      å‘é€
    </button>
  </view>

  <!-- è§é¢ä¿¡æ¯è¾“å…¥ -->
  <view wx:elif="{{sessionInfo.status === 'active' && !sessionInfo.meetingPoint}}" class="input-container">
    <input
      class="input-box"
      placeholder="è¾“å…¥è§é¢åœ°ç‚¹..."
      value="{{meetingPointInput}}"
      bindinput="onInputMeetingPoint"
    ></input>

    <button
      class="send-btn {{meetingPointInput.trim() ? '' : 'disabled'}}"
      bindtap="setMeetingPoint"
      disabled="{{!meetingPointInput.trim()}}"
    >
      çº¦å®š
    </button>
  </view>

  <!-- å·²å®ŒæˆçŠ¶æ€ -->
  <view wx:elif="{{sessionInfo.status === 'completed'}}" class="input-container">
    <text style="flex: 1; text-align: center; color: #999; font-size: 28rpx;">äº’åŠ©å·²å®Œæˆï¼Œæ„Ÿè°¢æ‚¨çš„ä½¿ç”¨</text>
  </view>
</view>
