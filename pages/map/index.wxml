<!-- pages/map/index.wxml -->
<view class="map-container">
  <!-- åŸç”Ÿåœ°å›¾ç»„ä»¶ -->
  <map
    id="tencentMap"
    class="tencent-map"
    longitude="{{longitude}}"
    latitude="{{latitude}}"
    scale="{{scale}}"
    markers="{{markers}}"
    show-location="{{true}}"
    bindmarkertap="onMarkerTap"
    bindregionchange="onRegionChange"
    bindtap="onMapTap"
    enable-3D="{{false}}"
    show-compass="{{true}}"
    enable-overlooking="{{false}}"
    enable-zoom="{{true}}"
    enable-scroll="{{true}}"
    enable-rotate="{{false}}"
  >
    <!-- è‡ªå®šä¹‰æ ‡æ³¨ç‚¹ -->
    <cover-view slot="callout">
      <cover-view
        wx:for="{{markers}}"
        wx:key="id"
        class="custom-callout {{item.type}}"
        marker-id="{{item.id}}"
      >
        <cover-view class="callout-content">
          <cover-view class="callout-icon">{{item.type === 'helper' ? 'ğŸ¤' : 'ğŸ†˜'}}</cover-view>
        </cover-view>
      </cover-view>
    </cover-view>
  </map>

  <!-- é¡¶éƒ¨çŠ¶æ€æç¤º -->
  <view class="status-bar">
    <view class="status-info">
      <text class="status-icon">ğŸ“</text>
      <text class="status-text">{{statusText}}</text>
    </view>
  </view>

  <!-- å³ä¾§æ§åˆ¶æŒ‰é’® -->
  <view class="control-buttons">
    <!-- å®šä½æŒ‰é’® -->
    <view class="control-btn" bindtap="moveToLocation">
      <text class="btn-icon">ğŸ¯</text>
    </view>
    <!-- æ”¾å¤§æŒ‰é’® -->
    <view class="control-btn" bindtap="zoomIn">
      <text class="btn-icon">â•</text>
    </view>
    <!-- ç¼©å°æŒ‰é’® -->
    <view class="control-btn" bindtap="zoomOut">
      <text class="btn-icon">â–</text>
    </view>
  </view>

  <!-- å›¾ä¾‹ -->
  <view class="legend">
    <view class="legend-item">
      <view class="legend-dot helper"></view>
      <text class="legend-text">å¸®åŠ©è€…</text>
    </view>
    <view class="legend-item">
      <view class="legend-dot seeker"></view>
      <text class="legend-text">æ±‚åŠ©è€…</text>
    </view>
  </view>

  <!-- åº•éƒ¨ä¿¡æ¯é¢æ¿ -->
  <view wx:if="{{selectedMarker}}" class="bottom-sheet {{showSheet ? 'show' : ''}}">
    <view class="sheet-header">
      <view class="sheet-info">
        <text class="sheet-type">
          {{selectedMarker.type === 'helper' ? 'ğŸ¤ é™„è¿‘çš„å¸®åŠ©è€…' : 'ğŸ†˜ é™„è¿‘çš„æ±‚åŠ©è€…'}}
        </text>
        <text class="sheet-distance">è·ç¦»çº¦ {{selectedMarker.distance}} ç±³</text>
      </view>
      <view class="close-btn" bindtap="closeBottomSheet">
        <text>âœ•</text>
      </view>
    </view>

    <view class="sheet-tags">
      <text class="tag">
        {{selectedMarker.type === 'helper' ? selectedMarker.provide : selectedMarker.need}}
      </text>
    </view>

    <view class="sheet-actions">
      <button class="action-btn primary" bindtap="contactPerson">
        {{selectedMarker.type === 'helper' ? 'è”ç³»å¥¹' : 'æˆ‘å¯ä»¥æä¾›å¸®åŠ©'}}
      </button>
      <button class="action-btn secondary" bindtap="navigateTo">
        <text class="btn-text">å¯¼èˆª</text>
      </button>
    </view>
  </view>
</view>
