<!--pages/messages/index.wxml-->
<view class="messages-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æ¶ˆæ¯</text>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <view class="messages-list">
    <view
      wx:for="{{conversations}}"
      wx:key="conversationId"
      class="conversation-item"
      bindtap="openConversation"
      data-id="{{item.conversationId}}"
    >
      <!-- ç”¨æˆ·å¤´åƒ -->
      <view class="user-avatar">
        <image wx:if="{{item.otherUserInfo.avatarUrl}}" src="{{item.otherUserInfo.avatarUrl}}" mode="aspectFill"></image>
        <view wx:else class="default-avatar">{{item.otherUserInfo.nickname ? item.otherUserInfo.nickname.substr(0,1) : 'U'}}</view>
      </view>

      <!-- å¯¹è¯ä¿¡æ¯ -->
      <view class="conversation-info">
        <view class="conversation-top">
          <text class="user-name">{{item.otherUserInfo.nickname || 'åŒ¿åç”¨æˆ·'}}</text>
          <text class="last-time">{{item.lastMessageTime}}</text>
        </view>
        <view class="conversation-bottom">
          <text class="last-message">{{item.lastMessage || 'æš‚æ— æ¶ˆæ¯'}}</text>
          <view wx:if="{{item.unreadCount > 0}}" class="unread-badge">
            <text>{{item.unreadCount > 99 ? '99+' : item.unreadCount}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{conversations.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“¨</text>
      <text class="empty-text">æš‚æ— æ¶ˆæ¯</text>
    </view>
  </view>
</view>
